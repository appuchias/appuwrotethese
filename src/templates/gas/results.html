{% extends 'base.html' %}
{% load user_agents i18n %}

{% block title %}Resultados{% endblock %}

{% load replace access %}

{% block content %}
<div id="search-result">
    <div class="text-center">
        <div class="title{% if request|is_mobile %} mobile{% endif %}">{% trans 'Stations' %}</div>
        <p class="text-themed">{% trans "The icon at the bottom of every card opens the route to the station in your maps app" %}.</p>
        {% if user.is_authenticated %}<p class="text-themed">{% trans "A red icon means last week price was lower. A green one means now it's cheaper" %}.</p>{% endif %}
        <p class="last-update text-themed">{% trans "Price of" %} {{ fuel }} {% trans "in" %} {{ term }} {% trans "on the" %} {{ date }}</p>

        <!-- Grid with gas stations -->
        <div id="results-cards" class="container">
            <div class="row justify-content-sm-around justify-content-center g-1">
                {% for i in results %}{% with s=i.station %}
                <div class="card-wrapper col-xl-2 col-md-3 col-sm-4 col-12">
                    <div class="card">
                        <div class="card-header{% if user.is_authenticated %} container row justify-content-start{% endif %}">
                            {% if user.is_authenticated %}
                            <h2 class="col-1" title="{% if prev_lower|access:s.id_eess == -1 %}{% trans "More expensive" %}{% elif prev_lower|access:s.id_eess == 1 %}{% trans "Cheaper" %}{% else %}{% trans "Same price" %}{% endif %}">
                                {% if prev_lower|access:s.id_eess == -1 %}<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="red" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-trending-up"><polyline points="22 7 13.5 15.5 8.5 10.5 2 17"/><polyline points="16 7 22 7 22 13"/></svg>
                                {% elif prev_lower|access:s.id_eess == 1 %}<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="lightgreen" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-trending-down"><polyline points="22 17 13.5 8.5 8.5 13.5 2 7"/><polyline points="16 17 22 17 22 11"/></svg>
                                {% else %}<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="blue" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-equal"><line x1="5" x2="19" y1="9" y2="9"/><line x1="5" x2="19" y1="15" y2="15"/></svg>
                                {% endif %}
                            </h2>
                            <h2 class="col truncate" title="{{ s.company|title }}">{{ s.company|title }}</h2>
                            {% else %}
                            <h2 title="{{ s.company|title }}" class="truncate">{{ s.company|title }}</h2>
                            {% endif %}
                        </div>
                        <div class="card-body">
                            <p class="truncate" title="{{ s.address }}">{{ s.address }}</p>
                            <p>{{ s.locality }}</p>
                            <p class="horario">{{ s.schedule }}</p>
                            <div class="price-chart">
                                <table class="table table-sm table-hover">
                                    <thead>
                                        <tr>
                                            <th scope="col">{% trans "Fuel" %}</th>
                                            <td scope="col"><strong>€/L</strong></td>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <th scope="row">Gasóleo A</th>
                                            <td>{{ i.price_goa|default:"-" }}</td>
                                        </tr>
                                        <tr>
                                            <th scope="row">Gasolina 95</th>
                                            <td>{{ i.price_g95e5|default:"-" }}</td>
                                        </tr>
                                        <tr>
                                            <th scope="row">Gasolina 98</th>
                                            <td>{{ i.price_g98e5|default:"-" }}</td>
                                        </tr>
                                        <tr>
                                            <th scope="row">GLP</th>
                                            <td>{{ i.price_glp|default:"-" }}</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                            <div class="d-flex justify-content-start">
                                <a href="#" class="text-decoration-none" aria-label="{% trans 'Open maps route' %}" data-balloon-pos="up"
                                    onclick="openmaps({{ s.latitude|replace:',|.' }}, {{ s.longitude|replace:',|.' }}, '{{ s.company }}', '{{ s.address }}')">
                                    <i data-lucide="compass"></i>
                                </a>
                            </div>
                        </div>
                    </div>
                </div>{% endwith %}{% endfor %}
            </div>
            <a href="https://coindrop.to/appuchia" class="text-themed text-decoration-none float-center p-2 border border-light rounded-3" rel="noopener noreferrer" aria-label="{% trans 'Hosting is not free' %}!" data-balloon-pos="up"><i data-lucide="coins"></i> {% trans "Support me" %}!</a>
            <script>
                function openmaps(lat, long, name, address) {
                    window.open("https://www.google.com/maps?f=d&saddr=My+Location&z=15&ll=" + lat + "," + long + "&daddr=" + name + " " + address);
                    // // If it's an iPhone..
                    // if ((navigator.platform.indexOf("iPhone") != -1) ||
                    //     (navigator.platform.indexOf("iPod") != -1) ||
                    //     (navigator.platform.indexOf("iPad") != -1))
                    //     window.open("maps://www.google.com/maps/dir/?api=1&travelmode=driving&layer=traffic&destination=" + lat + "," + long);
                    // else
                    //     window.open("https://www.google.com/maps?f=d&saddr=My+Location&z=15&ll=" + lat + "," + long + "&daddr=" + name + "");
                }
            </script>
        </div>
    </div>
</div>
{% endblock %}
